function loadComments(url){$.ajax({url:url+"?callback=?",dataType:'jsonp',crossDomain:true,complete:(function(){populateReplyForm(url);})});}
function comments(data){$("#comments").html("");id=1
if(data.length>0){$("#comments").prepend("<h2>Comments</h2>");}
$.each(data,function(key,val){var author=val["author"];var body=val["body"];var ago=val["ago"];$("#comments").append("<div class=\"comment\"> \
<div class=\"link\"><a href=\"#comment_"+id+"\">#</a></div> \
<div class=\"title\"><a name=\"comment_"+id+"\">Author: "+author+"</a></div> \
<div class=\"tagline\">"+ago+"<br /></div> \
<div class=\"body\">"+body+"</div> \
</div>");id+=1;});}
function populateReplyForm(url){$("#comments").append("<div id=\"comments-reply\"></div>");$("#comments-reply").html(" \
  <h2>Add Comment</h2> \
  <blockquote> \
<form method=\"POST\" id=\"myform\" action=\"\"> \
      <table> \
        <tr> \
          <td>Your Name</td> \
          <td><input type=\"text\" name=\"author\" /></td> \
        </tr> \
        <tr> \
          <td colspan=\"2\"><textarea name=\"body\" rows=\"5\" cols=\"50\"></textarea></td> \
        </tr> \
        <tr> \
          <td></td> \
          <td align=\"right\"><input type=\"submit\" value=\"Add Comment\"/></td> \
        </tr> \
      </table> \
    </form> \
  </blockquote> \
");$("#myform").bind("submit",(function(){$("#myform").hide();$.ajax({type:"POST",url:url,data:$("#myform").serialize(),error:function(r,e){loadComments(url);},complete:function(r,e){loadComments(url);},datatype:'jsonp',})
return false;}));}
function discussion(url){loadComments(url)}